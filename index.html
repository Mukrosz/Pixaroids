<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixarithm Minted Fragments</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #0f0f0f, #1a1a2e);
            color: #f0f0f0;
            text-align: center;
            padding: 20px;
            margin: 0;
        }
        h1 {
            font-size: 2rem;
            text-shadow: 2px 2px 10px rgba(255, 255, 255, 0.3);
        }
        #chart-container {
            width: 90%;
            max-width: 800px;
            height: 600px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0px 0px 15px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <h1>Pixarithm Minted Fragments</h1>
    <div id="chart-container">
        <canvas id="mintedChart"></canvas>
    </div>
    <script>
        async function fetchData() {
            const query = `
                query {
                    inscription(where: { collection: { symbol: { _eq: "PIXAROIDS5" } } }) {
                        metadata(path: "$.metadata.name")
                        current_owner
                    }
                }
            `;

            const response = await fetch("https://new-api.asteroidprotocol.io/v1/graphql", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query })
            });

            const result = await response.json();
            const inscriptions = result.data.inscription;

            const counts = {};
            const owners = {};
            inscriptions.forEach(i => {
                const match = i.metadata.match(/^(.*?) Fragment \d+$/);
                if (match) {
                    const name = match[1];
                    counts[name] = (counts[name] || 0) + 1;
                    if (!owners[name]) owners[name] = [];
                    owners[name].push(i.current_owner);
                }
            });

            const totalMinted = Object.values(counts).reduce((sum, value) => sum + value, 0);
            const totalFragments = 152;

            const sortedData = Object.entries(counts)
                .map(([name, count]) => ({ Pixarith: name, Minted: count }))
                .sort((a, b) => a.Pixarith.localeCompare(b.Pixarith));

            const labels = sortedData.map(item => item.Pixarith);
            const data = sortedData.map(item => item.Minted);
            const backgroundColors = labels.map(name => {
                return counts[name] === 4 && new Set(owners[name]).size === 1 ? "rgba(0, 255, 0, 0.7)" : "rgba(173, 216, 230, 0.7)";
            });

            const ctx = document.getElementById("mintedChart").getContext("2d");
            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Fragments Minted (${totalMinted}/${totalFragments})`,
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: "rgba(173, 216, 230, 1)",
                        borderWidth: 2,
                        borderRadius: 5,
                        hoverBackgroundColor: "rgba(138, 43, 226, 0.7)"
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    const pixarithName = labels[tooltipItem.dataIndex];
                                    const ownerList = owners[pixarithName] ? owners[pixarithName].join("\n") : "No owners found";
                                    return ownerList.split("\n");
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: "Fragments Minted", font: { size: 14, weight: 'bold' } },
                            min: 0,
                            max: 5,
                            ticks: { stepSize: 1 }
                        },
                        y: { title: { display: true, text: "Pixarith Name", font: { size: 14, weight: 'bold' } } }
                    }
                }
            });
        }
        window.onload = fetchData;
    </script>
</body>
</html>

